<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="adminMapper">

<!--    <resultMap id="admin" type="com.green.shop.admin.vo.MemberVO">-->
<!--        <result column="MEMBER_ROLL" property="memberRoll"/>-->
<!--    </resultMap>-->

<!-- 다음에 INSERT할 ITEM_CODE를 조회 -->
    <select id="selectItemCode" resultType="int">
        SELECT IFNULL(MAX(ITEM_CODE), 0) + 1 FROM shop_item;
    </select>

<!-- 상품 등록 (관리자만 사용 가능)-->
    <insert id="insertItem">
        INSERT INTO SHOP_ITEM (
              ITEM_CODE
            , ITEM_NAME
            , ITEM_PRICE
            , ITEM_INTRO
            , CATE_CODE
        ) VALUES (
              #{itemCode}
            , #{itemName}
            , #{itemPrice}
            , #{itemIntro}
            , #{cateCode}
        )
    </insert>

<!-- 상품 이미지 정보 등록 (관리자만 사용 가능) -->
<!-- 이미지를 등록한 갯수만큼 반복해야 함 -->
<!-- foreach -->
<!-- collection : 반복 돌릴거 -->
<!-- item : 개별 자료형 -->
<!-- separator : 구분자 -->
    <insert id="insertImgs">
        INSERT INTO ITEM_IMAGE (
            ORIGIN_FILE_NAME
            , ATTACHED_FILE_NAME
            , IS_MAIN
            , ITEM_CODE
        ) VALUES
    <foreach collection="imgList" item="img" separator=",">
        (
        #{img.originFileName}
        , #{img.attachedFileName}
        , #{img.isMain}
        , #{img.itemCode}
        )
    </foreach>
    </insert>


    <!-- 구매기록 조회 (관리자용) -->
    <select id="selectBuyInfoList" resultMap="buyMapper.buy">
        SELECT BUY_CODE
            , MEMBER_ID
            , BUY_PRICE
            , BUY_DATE
        FROM SHOP_BUY
        ORDER BY BUY_DATE DESC
    </select>



</mapper>































